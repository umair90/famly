<!DOCTYPE html>

<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" id="viewport">
        <script type="text/javascript">
                var viewPortWidth = window.screen.width;
                function setViewport() {
                    if ((navigator.userAgent.toLowerCase().indexOf("android")!=-1)) {
                        
                        var vPort = "width="+viewPortWidth+", maximum-scale=1, minimum-scale=1, initial-scale=1, user-scalable=yes";
                        document.getElementById("viewport").setAttribute("content", vPort);
                    }
                }
                setViewport();
                </script>
        <link href="js/slide.css" rel="stylesheet" media="screen">
            
                            <style>
                                div {
                                    -webkit-touch-callout: none;
                                    -webkit-user-select: none; /* Disable selection/Copy of UIWebView */
                                }
                                body{
                                    background: url(img/back.jpg) repeat;
                                    overflow:hidden;
                                }
                                .b
                                {
                                    text-shadow:none !important;
                                    background:#F88E1E !important;
                                    font-weight:600 !important;
                                    color:#FFF !important;
                                }
                                /* To set it to none use a totally transparent RGBA */
                                * { -webkit-tap-highlight-color: rgba(0,0,0,0); }
                                
                                .bttn
                                {
                                    text-shadow:none !important;
                                    background:#F88E1E !important;
                                    font-weight:600 !important;
                                    width:48px !important;
                                    height:30px !important;
                                }
                                .button_home
                        {
                            background-image: url(img/home.png) !important; /* 16px x 16px */
                            background-color: #F88E1E !important; /* make the button transparent */
                            background-repeat: no-repeat !important;  /* make the background image appear only once */
                            background-position: 4px 4px !important;  /* equivalent to 'top left' */
                            background-size: 30px 25px !important;
                            height: 35px !important;
                            width:40px !important;
                            vertical-align: middle !important;
                            
                        }
                        .button_menu
                        {
                            background-image: url(img/settings.png) !important; /* 16px x 16px */
                            background-color: #F88E1E !important; /* make the button transparent */
                            background-repeat: no-repeat !important;  /* make the background image appear only once */
                            background-position: 4px 4px !important;  /* equivalent to 'top left' */
                            background-size: 30px 25px !important;
                            height: 35px !important;
                            width:40px !important;
                            vertical-align: middle !important;
                            
                        }
                               
                                .thead{
                                    font-weight:600;
                                    font-size:9px;
                                }
                                
                                .layout-slider { margin-top: 30px; width: 80%; }
                                
                                @media only screen and (device-height: 568px) and (-webkit-min-device-pixel-ratio: 2) {
                                    .nmsg {
                                        overflow:scroll; height:85%
                                    }
                                    .rmsg {
                                        /* overflow:scroll; height:58% */
                                        overflow:scroll; height:55%
                                    }
                                }
                                @media only screen and (device-height: 480px){
                                    .nmsg {
                                        overflow:scroll; height:85%
                                    }
                                    .rmsg {
                                        /* overflow:scroll; height:50% */
                                        overflow:scroll; height:55%
                                    }
                                }
                                
                                 #menu {
                            background: none repeat scroll 0 0 #333333;
                            bottom: 0;
                            overflow: auto;
                            position: fixed;
                            top: 0;
                            width: 70%;
                            z-index: 1;
                        }
                        #menu ul {
                            margin-left: 10px;
                            display: block;
                            height: 100%;
                            overflow-y: scroll;
                        }
                        #menu ul li a {
                            background:#333333;
                            border-bottom: 1px solid #222222;
                            box-shadow: 0 1px 0 rgba(255, 255, 255, 0.05) inset;
                            color: #FFFFFF;
                            display: block;
                            font-weight: bold;
                            padding: 10px;
                            text-decoration: none;
                            text-shadow: 0 1px 0 #000000;
                        }
                        #menu ul li a.active {
                            background-color: #336C95;
                        }
                                
                             
                                #wrapper {
                                    background: url(img/back.jpg) repeat;
                                    position: absolute;
                                    top: 0;
                                    left: 0;
                                    bottom: 0;
                                    z-index: 9990;
                                    padding-top: 25%;
                                    width:100%;
                                }
                               
                                #wrapper ul {
                                    display: block;
                                    height: 100%;
                                    overflow-y: scroll;
                                }
                                #wrapper ul li a{
                                    background: #FFF;
                                    border-bottom: 1px solid #222222;
                                    font-size: 16px;
                                    display: block;
                                    font-weight: bold;
                                    padding: 10px;
                                }
                                
                                </style>

                            
                            <script src="js/cordova.js"></script>
                            <script src="js/jquery.js"></script>
                            <script src="js/jquery.blockUI.js"></script>
                            <script src="bootstrap/js/bootstrap.min.js"></script>
                            <script type="text/javascript" charset="utf-8" src="js/ajaxfileupload.js"></script>
            <link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
            <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
                                                        </head>
    <body>
        <link href="bootstrap/css/bootstrap.css" rel="stylesheet" media="screen">
        <link rel="stylesheet" href="slider/stylesheets/jslider.css" type="text/css">
            <link rel="stylesheet" href="slider/stylesheets/jslider.round.css" type="text/css">
                <script type="text/javascript" src="slider/javascripts/jquery.dependClass.js"></script>
                <script type="text/javascript" src="slider/javascripts/jquery.slider.js"></script>

        
        <div id="menu">
            <ul>
                <li>
                    <div class="form-search">
                        <div class="input-append">
                            <input id="search_name" type="text" class="span2 input-medium search-query" placeholder="Search">
                                <button onClick="search()" class="btn b"><i class="icon-search icon-white"></i></button>
                                </div>
                    </div>
                </li>
                <li><a href="index.html"><i class="icon-home icon-white"></i>  Home</a></li>
                <li><a href="javascript:prof()"><i class="icon-user icon-white"></i>  My Profile</a></li>
                <li><a href="me.html"><i class="icon-th icon-white"></i>  My Famly</a></li>
                <li><a href="tree.html"><i class="icon-leaf icon-white"></i>  My Famly Tree</a></li>
                <li><a href="map.html"><i class="icon-globe icon-white"></i>  My Famly Map</a></li>
                <li><a href="javascript:goAlb()"><i class="icon-picture icon-white"></i>  My Famly Gallery</a></li>
                        <li><a href="events.html"><i class="icon-calendar icon-white"></i>  My Famly Events</a></li>
                <li><a href="memorials.html"><i class="icon-star icon-white"></i>  My Famly Memos</a></li>
                <li><a href="javascript:jour()"><i class="icon-book icon-white"></i>  My Famly Journals</a></li>
                <li><a href="settings.html"><i class="icon-cog icon-white"></i>  Settings</a></li>
                
                
            </ul>
        </div>
        
        <div id="toppanel" style="position:fixed !important; z-index: 999999 !important;">
            
            <div class="tabback">
                <div class="tab">
                    <div style="position:absolute; left:2px; top:1px">
                        <div class="btn-group">
                            <button id="menuShow" class="btn button_menu" onClick="slide()"></button>
                        </div>
                    </div>
                    <div id="clos" style="background:transparent; width:50%; height:90%; margin-left:35%">&nbsp;</div>
                    <div style="position:absolute; right:2px; top:1px">
                        <div class="btn-group">
                            <button class="btn button_home" onClick="goHome()"></button>
                        </div>
                    </div>
                </div>
            </div>
                
        </div> <!--panel -->
                
        <div id="wrapper">
        
            <div style="position: relative; float:left; width:96%; margin:2%">
    
                <ul class="nav nav-tabs nav-stacked">
                    <li><a href="accSettings.html"><i class="icon-chevron-right pull-right"></i> Account Settings</a></li>
                    <li><a href="privSettings.html"><i class="icon-chevron-right pull-right"></i> Privacy Settings</a></li>
                    <li><a href=""><i class="icon-chevron-right pull-right"></i> Terms &amp; Conditions</a></li>
                    <li><a href="help.html"><i class="icon-chevron-right pull-right"></i> Help</a></li>
                    <li><a href="login.html">Logout</a></li>
                </ul>
            </div>
            

        </div>
        
        <script>

            function slide(){
                if ($("#toppanel").hasClass('isSlided') && $("#wrapper").hasClass('isSlided')){
        			$("#toppanel").animate({"left":"0px"}, "fast").removeClass('isSlided');
             		$("#wrapper").animate({"left":"0px"}, "fast").removeClass('isSlided');
             		
    			} else {
        			$("#toppanel").animate({"left":"70%"}, "fast").addClass('isSlided');
             		$("#wrapper").animate({"left":"70%"}, "fast").addClass('isSlided');
    			}
            		
           	   } 
           	   
           	   
            function check(){
                if(document.getElementById("handler-left").checked)
                document.getElementById("handler-left").checked=false
                else
                document.getElementById("handler-left").checked=true
            }
            
            function prof(){
                var id = sessionStorage.getItem('userid');
                window.open('profilePage.html?id='+id, '_self');
                
            }
            
            function jour(){
                var id = sessionStorage.getItem('userid');
                window.open('journals.html?jid='+id, '_self');
                
            }
            
            function goHome(){
                window.open('index.html', '_self');
                
            }
            
            function goAlb(){
                var id = sessionStorage.getItem('userid');
                window.open('album.html?id='+id, '_self');
                
            }
            
            function search(){
                
                var full_name = $("#search_name").val();
                window.open('searchResults.html?name='+full_name, '_self');
            }
            
            function filter(){
                sessionStorage['lower']=$('#visUpdate #lower').html();
                sessionStorage['higher']=$('#visUpdate #higher').html();
                $("#visUpdate").slideUp();
            }
            
            function linkingStat(evt) {
                evt = (evt) ? evt : event;
                var charCode = (evt.charCode) ? evt.charCode : ((evt.keyCode) ? evt.keyCode :
                                                                ((evt.which) ? evt.which : 0));
                if (charCode == 62){
                    $("#attachStatLink").slideDown();
                    //$("#textarea1").attr("style","color:#12B6E9; font-size:15px; width:79%; margin-top:4%");
                }
                if (charCode == 60){
                    //$("#textarea1").attr("style","color:#000; font-size:15px; width:79%; margin-top:4%");
                }
                if (charCode == 64){
                    /*   $("#textarea1").autocomplete({
                     source: ["ActionScript",
                     "AppleScript",
                     "Asp",
                     "BASIC",
                     "C",
                     "C++",
                     "Clojure",
                     "COBOL",
                     "ColdFusion",
                     "Erlang",
                     "Fortran",
                     "Groovy",
                     "Haskell",
                     "Java",
                     "JavaScript",
                     "Lisp",
                     "Perl",
                     "PHP",
                     "Python",
                     "Ruby",
                     "Scala",
                     "Scheme"]
                     }); */
                }
                
            }
            
            function linkingRep(evt) {
                evt = (evt) ? evt : event;
                var charCode = (evt.charCode) ? evt.charCode : ((evt.keyCode) ? evt.keyCode :
                                                                ((evt.which) ? evt.which : 0));
                if (charCode == 62){
                    $("#attachRepLink").slideDown();
                    //$("#textarea1").attr("style","color:#12B6E9; font-size:15px; width:79%; margin-top:4%");
                }
                if (charCode == 60){
                    //$("#textarea1").attr("style","color:#000; font-size:15px; width:79%; margin-top:4%");
                }
                
            }
            
            function linkingMsg(evt) {
                evt = (evt) ? evt : event;
                var charCode = (evt.charCode) ? evt.charCode : ((evt.keyCode) ? evt.keyCode :
                                                                ((evt.which) ? evt.which : 0));
                if (charCode == 62){
                    $("#attachMsgLink").slideDown();
                    //$("#textarea1").attr("style","color:#12B6E9; font-size:15px; width:79%; margin-top:4%");
                }
                if (charCode == 60){
                    //$("#textarea1").attr("style","color:#000; font-size:15px; width:79%; margin-top:4%");
                }
                
            }
            
            function emptyStat(evt) {
                if($("#statImageDiv").is(":visible")){
                    $('#statImageDiv').slideUp();
                    sessionStorage['imgAtch'] = "";
                    $("#svb").removeAttr("disabled");
                    $("#progCont").slideUp();
                }
                if($("#statVidDiv").is(":visible")){
                    $('#statVidDiv').slideUp();
                    sessionStorage['vidAtch'] = "";
                    $("#sib").removeAttr("disabled");
                    $("#progCont").slideUp();
                }
                $("#statText").val("");
                $("#statLink").val("");
                $("#attachStatLink").slideUp();
                $("div[id^=panel]").slideUp(400);
            }
            
            function emptyRep(evt) {
                if($("#repImageDiv").is(":visible")){
                    $('#repImageDiv').slideUp();
                    sessionStorage['imgAtch'] = "";
                    $("#rvb").removeAttr("disabled");
                }
                if($("#repVidDiv").is(":visible")){
                    $('#repVidDiv').slideUp();
                    sessionStorage['vidAtch'] = "";
                    $("#rib").removeAttr("disabled");
                }
                $("#repText").val("");
                $("#repLink").val("");
                $("#attachRepLink").slideUp();
                $("div[id^=panel]").slideUp(400);
            }
            
            function emptyMsg(evt) {
                if($("#msgImageDiv").is(":visible")){
                    $('#msgImageDiv').slideUp();
                    sessionStorage['imgAtch'] = "";
                    $("#mvb").removeAttr("disabled");
                }
                if($("#msgVidDiv").is(":visible")){
                    $('#msgVidDiv').slideUp();
                    sessionStorage['vidAtch'] = "";
                    $("#mib").removeAttr("disabled");
                }
                $("#msgRecp").val("")
                $("#msgText").val("");
                $("#msgLink").val("");
                $("#attachMsgLink").slideUp();
                $("div[id^=panel]").slideUp(400);
            }
            
            function showBrowser(){
                var ref = window.open('http://www.bing.com', '_blank', 'location=yes');
                ref.addEventListener('loadstop', iabStop);
                ref.addEventListener('exit', iabClose);
            }
            
            function iabStop(event){
                sessionStorage['url'] = event.url;
            }
            
            function iabClose(event){
                if($("#attachStatLink").is(":visible"))
                $("#statLink").val(sessionStorage.getItem('url'));
                else if($("#attachRepLink").is(":visible"))
                $("#repLink").val(sessionStorage.getItem('url'));
                else if($("#attachMsgLink").is(":visible"))
                $("#msgLink").val(sessionStorage.getItem('url'));
            }
            
            
            $(document).ready(function() {
                              userList();
                              
                              $("#search_name").autocomplete({
                                                             source: fname,
                                                             minLength: 0,
                                                             select: function(event, ui) {
                                                             //assign value back to the form element
                                                             if(ui.item){
                                                             $(event.target).val(ui.item.value);
                                                             names=ui.item.value;
                                                             }
                                                             searchedUser();
                                                             }
                                                             }).data("autocomplete")._renderItem = function (ul, item) {
                              var inner_html = '<a style="height:100% !important;">'
                              +'<div style="height:30px !important; width:30px !important;"> '
                              + '  <img src="http://famly.com/beta/public/uploads/user_pics/'+ fpic[fname.indexOf(item.value)] +'" style="width:100%; height:100%; overflow:hidden; border:2px solid #DEDEDE"/> '
                              + '  </div> '
                              +'<span style="position:absolute; margin-left:40px; height:100% !important; width:80% !important; overflow:hidden; margin-top:-20px; font-size:11px">' + item.value + '</span><p></p><p></p><p></p><p></p></a>';
                              //alert(item);
                              return $('<li class="list_item_container"></li>')
                              .data("item.autocomplete", item)
                              .append(inner_html)
                              .appendTo(ul);
                              };
                              
                              
                              });
            
            var fname = new Array();
            var fid= new Array();
            var fpic= new Array();
            var names;
            function userList(){
                var un=sessionStorage.getItem('username');
                var hash=sessionStorage.getItem('password');
                var userId=sessionStorage.getItem('userid');
                url2 = 'http://famly.com/beta/public/ws/userList.php?userId='+userId;
                $.get(url2,{}, function(data){
                      
                      data2 = $.parseJSON(data);
                      $(data2).each(function(i,val){
                                    fname[i]=val.name;
                                    //alert(fname[i]);
                                    fid[i]=val.id;
                                    fpic[i]=val.picture;
                                    // alert(fid[i]);
                                    });
                      
                      });
                
            }
            
            function searchedUser(){
                
                var indexArray= new Array();
                var index;
                for(i=0;i<fname.length;i++){
                    if(names==fname[i]){
                        index=i;
                    }
                }
                var id=fid[index];
                var picture=fpic[index];
                window.open('profilePage.html?id='+id, '_self');
                
            }

            function search(){
                
                var full_name = $("#search_name").val();
                window.open('searchResults.html?name='+full_name, '_self');
            }
            
            
            $.blockUI();
            
            var errors = "";
            var errors2 = "";
            function getPhoto(){
                
              
                
            }
            
            function onSuccess(imageData) {
                var image = document.getElementById('myImage');
                image.src = imageData;
                //image.src = "data:image/jpeg;base64," + imageData;
                //alert(imageData)

            }
            
            function onFail(message) {
                alert('Failed because: ' + message);
            }
            
            function validatefirstName(name){
                var valid=true;
                var filter=/^[a-zA-Z ]+$/;
                var test_bool = filter.test(name);
                if(test_bool==false){
                    //$("#message").attr("style","display:inline;");
                    //$("#incorrect").text("First Name must contain alphabets");
                    errors += "<br>First Name must only contain alphabets";
                    valid=false;
                }
                
                console.log("firstname validated");
                return valid;
                
                
            }
            
            function validatePassword(pass){
                if(pass.length<6){
                    //$("#message").attr("style","display:inline;");
                    errors2 += "<br>Password must contain atleast 6 characters";
                    return false;
                }
                
                console.log("Password validated");
                return true;
                
            }
            
            function validatelastName(name){
                var valid=true;
                var filter=/^[a-zA-Z ]+$/;
                var test_bool = filter.test(name);
                if(test_bool==false){
                    //$("#message").attr("style","display:inline;");
                    //$("#incorrect").text("Last Name must contain alphabets");
                    errors += "<br>Last Name must contain alphabets";
                    valid=false;
                }
                console.log("lastname validated");
                return valid;
            }
            
            function imgToggle(){
                $("#imgUpdate").slideToggle();
                
            }
            
            function visToggle(){
                $("#visUpdate").slideToggle();
                $.scrollTo( "#Slider1", 800, {queue:true} );
                
            }
            
            function passToggle(){
                $("#passUpdate").slideToggle();
                
            }
            
            function genToggle(){
                $("#genUpdate").slideToggle();
                
            }
            
            function unameToggle(){
                $("#unameUpdate").slideToggle();
               //$("#username").val(sessionStorage.getItem('username'));
                $("#fname").val(sessionStorage.getItem('fname'));
                $("#lname").val(sessionStorage.getItem('lname'));
                // $("#Password3").slideToggle();
                
            }
            
            function save1(){
            
                var fn = document.getElementById('fname').value;
                var ln = document.getElementById('lname').value;
                var fnValid=validatefirstName(fn);
                var lnValid=validatelastName(ln);
               // var userNameValid=validateUsername(un);
                 if( fn == "" )
                {
                    //$("#message").attr("style","display:inline;");
                    //$("#incorrect").text("First Name is required");
                    errors += "<br>First Name is required";
                }
                else if( ln == "" )
                {
                    //$("#message").attr("style","display:inline;");
                    //$("#incorrect").text("Last Name is required");
                    errors += "<br>Last Name is required";
                }
                else if( fnValid==false )
                {
                    console.log("It shouldnt login, firstname is invalid")
                    // errors2 += "<br>Invalid Username  !";
                }
                else if( lnValid==false )
                {
                    console.log("It shouldnt login, lastname is invalid")
                    // errors2 += "<br>Invalid Username  !";
                }else{
                    var un=sessionStorage.getItem('username');
                    var hash=sessionStorage.getItem('password');
                    url='http://famly.com/beta/public/ws/changeName.php';
                    $.post(url, {username: un, password: hash, firstName:fn ,lastName:ln },function(data){
                           if (data==1){
                           sessionStorage['fname']=fn;
                           sessionStorage['lname']=ln;
                           }
                           });
                    if($("#message").is(":visible"))
                    $("#message").slideUp();
                    $("#unameUpdate").slideToggle();
                    
                }if (errors != ""){
                    $("#message").slideDown();
                    $("#incorrect").html(errors);
                    errors = "";
                }
                
            }
            
                        
            function save2(){
                
                var old_pw = document.getElementById('oPass').value;
                var new_pw = document.getElementById('nPass').value;
                var confirm_pw = document.getElementById('cPass').value;
                var hash_old_pw=SHA1(old_pw);
                var hash_new_pw=SHA1(new_pw);
                var hash_confirm_pw=SHA1(confirm_pw);
                var passwordValid=validatePassword(new_pw);
                
                if(passwordValid==false)
                {
                    errors2 += "<br>Invalid Password!";
                }
                else if (hash_old_pw!=sessionStorage.getItem('password')){
                    errors2 += "<br>Old Password Doesn't match !";
                    
                }
                else if (hash_confirm_pw!=hash_new_pw){
                    errors2 += "<br>New Password Doesn't match !";
                    
                }
                else if(old_pw == "")
                {
                    errors2 += "<br>Current Password is required !";
                }
                else if(new_pw == "")
                {
                    errors2 += "<br>New Password is required !";
                }
                else if(confirm_pw == "")
                {
                    errors2 += "<br>New Password doesn't match !";
                }
                
                else{
                    var un=sessionStorage.getItem('username');
                    url='http://famly.com/beta/public/ws/changePassword.php';
                    $.post(url,{username:un,password:hash_old_pw,newPass:hash_new_pw},function(data){
                           if (data==1){
                           sessionStorage['password']=hash_new_pw;
                           }
                           });
                    if($("#message2").is(":visible"))
                    $("#message2").slideUp();
                    $("#passUpdate").slideToggle();
                    
                }
                
                if (errors2 != ""){
                    $("#message2").slideDown();
                    $("#incorrect2").html(errors2);
                    errors2 = "";
                }
            }

            
            function save3(){
                
                var gen = "Male";
                if(document.getElementById("optionsRadios2").checked==true)
                {
                    gen = "Female";
                }
                
                var un=sessionStorage.getItem('username');
                var hash=sessionStorage.getItem('password');
                url='http://famly.com/beta/public/ws/changeGender.php';
                $.post(url, {username: un, password: hash, gender:gen },function(data){
                       if (data==1){
                       sessionStorage['gender']=gen;
                       }
                       });
            }

            
            function back(){
                $.blockUI();
                window.location.href="index.html";
                //$.unblockUI();
                
            }
            
            function ajaxFileUpload()
            {   var userId=sessionStorage.getItem('userid');
                //starting setting some animation when the ajax starts and completes
                
                $("#progCont")
                .ajaxStart(function(){
                           $("#progCont").slideDown();
                           })
                .ajaxComplete(function(){
                              $("#progCont").slideUp();
                              });
                
                setTimeout(function() {
                            // Do something every 1 min
                            $("#progCont").slideUp();
                            }, 80000);

                $.ajaxFileUpload
                (
                 {
                 url:'http://famly.com/beta/public/ws/doajaxfileupload.php?user_id='+userId,
                 secureuri:false,
                 fileElementId:'fileToUpload',
                 dataType: 'json',
                 success: function (data)
                 {
                 alert(data);
                 $("#progCont").slideUp();
                 
                 },
                 error: function (data, status, e)
                 {
                    $("#progCont").slideUp();
                    navigator.notification.alert(e,null,"Message","OK");
                 }
                 }
                 );
                
            }
            
            
            
            function hideAlert1(){
                $("#message").slideToggle();
                errors = "";
            }
            
            function hideAlert2(){
                $("#message2").slideToggle();
                errors2 = "";
            }
            
            $.unblockUI();

            
            function showPanel(id){
                if ($("div[id^=panel]").is(":visible")){
                    $("div[id^=panel]").slideUp(400);
                }
                if(id == 3)
                {
                    showMsgs();
                }
                else if(id == 8)
                {
                    showNotifs();
                            
                }
                
                if ($("#panel"+id).is(":visible")){
                    $("#panel"+id).slideUp(400);
                }else{
                    if(id==3){
                        $("#panel"+id).slideDown(400);
                    }
                    else{
                        
                        $("#panel"+id).slideDown(400);
                        
                    }
                }
            }
            
            
            function timeDifference(current, previous) {
                
                var msPerMinute = 60 * 1000;
                var msPerHour = msPerMinute * 60;
                var msPerDay = msPerHour * 24;
                var msPerMonth = msPerDay * 30;
                var msPerYear = msPerDay * 365;
                
                var elapsed = current - previous;
                
                if (elapsed < msPerMinute) {
                    if(Math.round(elapsed/1000)==1){
                        return 'A few second ago';
                    }
                    else{
                        return ' A few seconds ago';
                    }
                    
                }
                
                else if (elapsed < msPerHour) {
                    if(Math.round(elapsed/msPerMinute)==1){
                        return  Math.round(elapsed/msPerMinute) + ' minute ago';
                    }
                    else{
                        return  Math.round(elapsed/msPerMinute) + ' minutes ago';
                    }
                }
                
                else if (elapsed < msPerDay ) {
                    if(Math.round(elapsed/msPerHour)==1){
                        return  Math.round(elapsed/msPerHour) + ' hour ago';
                    }
                    else{
                        return  Math.round(elapsed/msPerHour) + ' hours ago';
                    }
                }
                
                else if (elapsed < msPerMonth) {
                    if(Math.round(elapsed/msPerDay)==1){
                        return  Math.round(elapsed/msPerDay) + ' day ago';
                    }
                    else{
                        return  Math.round(elapsed/msPerDay) + ' days ago';
                    }
                }
                
                else if (elapsed < msPerYear) {
                    if(Math.round(elapsed/msPerMonth)==1){
                        return  Math.round(elapsed/msPerMonth) + ' month ago';
                    }
                    else{
                        return  Math.round(elapsed/msPerMonth) + ' months ago';
                    }
                }
                
                else {
                    if(Math.round(elapsed/msPerYear)==1){
                        return Math.round(elapsed/msPerYear) + ' year ago';
                    }
                    else{
                        return  Math.round(elapsed/msPerYear) + ' years ago';
                    }
                }
            }
            
            var parseMonth = function (value) {
                
                switch (value) {
                    case "Jan":
                    return "01";
                    case "Feb":
                    return "02";
                    case "Mar":
                    return "03";
                    case "Apr":
                    return "04";
                    case "May":
                    return "05";
                    case "Jun":
                    return "06";
                    case "Jul":
                    return "07";
                    case "Aug":
                    return "08";
                    case "Sep":
                    return "09";
                    case "Oct":
                    return "10";
                    case "Nov":
                    return "11";
                    case "Dec":
                    return "12";
                    default:
                    return value;
                }};
            
            setInterval(function() {
                        var un=sessionStorage.getItem('username');
                        var hash=sessionStorage.getItem('password');
                        // Do something every 1 min
                        $.get(url2,{username: un, password: hash}, function(data){
                              data2 = $.parseJSON(data);
                              $(data2).each(function(i,val){
                                            if(parseInt(val.pending_count) > 0){
                                            $("#notifImg").attr("src","img/notif_new.jpg");
                                            //alert(val.pending_count);
                                            }
                                            });
                              });
                        }, 60000);
            
            function showNotifs(){
                url2 = 'http://famly.com/beta/public/ws/pendingRequestNotification.php';
                var un=sessionStorage.getItem('username');
                var hash=sessionStorage.getItem('password');
                $("#notifList").empty();
                //$("#panel3").attr("class","panel3");
                var currentDate = new Date()
                var day = currentDate.getDate()
                var month = currentDate.getMonth()
                var year = currentDate.getFullYear()
                var currentTime = new Date()
                var hours = currentTime.getHours()
                var minutes = currentTime.getMinutes()
                var seconds = currentTime.getSeconds()
                var currentDateTime= new Date(year,month,day,hours,minutes,seconds,00);
                $.get(url2,{username: un, password: hash}, function(data){
                      //alert(data);
                      data2 = $.parseJSON(data);
                      $(data2).each(function(i,val){
                                    //alert(val.sender_name);
                                    var postDate=val.created_at;
                                    var date = postDate.split("-");
                                    var postyyyy = date[0];
                                    var postmm = date[1]-1;
                                    var day_time = date[2];
                                    var day = day_time.split(" ");
                                    var postdd= day[0];
                                    
                                    var postDateTime=new Date(postyyyy,postmm,postdd);
                                    
                                    var timeTrack=timeDifference(currentDateTime,postDateTime);
                                    if(val.is_relation_accepted == 'Pending'){
                                    $("#notifList").append('<div id="not'+val.id+'" style="position:relative; float:left; width:100%; background: #FFF; margin-bottom:2%"> '
                                                           + ' <div style="position:relative; float:left; height:60px !important; width:60px !important; border:2px solid #DEDEDE; box-shadow:none; margin:1% 1% 1% 1%"> '
                                                           + '  <img src="http://famly.com/beta/public/uploads/user_pics/'+ val.sender_picture +'" style="width:100%; height:100%; overflow:hidden  " alt="loading" > '
                                                           + '  </div> '
                                                           + ' <div align="center" style="width:50%; padding:5px; position:relative; float:left"> '
                                                           + '  <p style="color:#12B6E9; font-weight:600">'+val.sender_name +'</p> '
                                                           + '  <p style="color: #BCBEBD; font-size:12px;">Added You As '+val.relation_name+'</p> '
                                                           + '  <p style="color: #BCBEBD; font-size:12px; margin-top:-15px;">'+timeTrack+'</p>'
                                                           +'  </div> '
                                                           + ' <div class="btn-group btn-group-vertical" style="position:relative; float:right"> '
                                                           + ' <button class="btn" type="button" onClick="invitation('+val.id+','+val.user_id+',0,\''+val.relation_name+'\')" style="color:#BDBDBD; font-weight:600">Reject</button> '
                                                           + '  <button class="btn" style="color:#BDBDBD; font-weight:600" onClick="invitation('+val.id+','+val.user_id+',1,\''+val.relation_name+'\')"> '
                                                           + '  Accept '
                                                           + '  </button> '
                                                           + '  </div> '
                                                           + '  </div>');
                                    }
                                    
                                    });
                      
                      });
                showEventNotifs();
            }
            
            function invitation(nid, sid, stat, relName){
                var st;
                var un=sessionStorage.getItem('username');
                var hash=sessionStorage.getItem('password');
                var gen=sessionStorage.getItem('gender');
                
                if (stat == 1)
                st = 'Accepted';
                else
                st = 'Ignore';
                
                url2 = 'http://famly.com/beta/public/ws/respondInvite.php';
                $.get(url2,{username:un, password:hash, status:st, sender_id:sid, relationName:relName, gender:gen}, function(data){
                      //alert(data);
                      $("#not"+nid).remove();
                      });
            }
            
            function replyMsg(){
                url2 = 'http://famly.com/beta/public/ws/postReply.php';
                var un=sessionStorage.getItem('username');
                var hash=sessionStorage.getItem('password');
                var user_reply = document.getElementById("repText").value;
                var id=sessionStorage.getItem('friendId');
                //alert("reply Msg"+id);
                var picture=sessionStorage.getItem('dp');
                var full_name=sessionStorage.getItem('fullname');
                $.get(url2,{username: un, password: hash,friendId:id,message:user_reply},function(data){
                      
                      });
                //$("#reply_post").remove();
                if (user_reply != ""){
                    $("#msgList").append('<div style="background: #FFF; border:1px solid">'
                                         + ' <div style="height:40px !important; width:40px !important; border:2px solid #DEDEDE; box-shadow:none; margin:1% 1% 1% 1%"> '
                                         + '  <img src="http://famly.com/beta/public/uploads/user_pics/'+picture+'" style="width:100%; height:100%; overflow:hidden  " alt="loading" > '
                                         + '  </div> '
                                         + '  <div align="left" style="margin-left:20%; margin-top:-40px">'
                                         + '  <p style="color:#12B6E9; font-weight:600;">'+full_name+'</p>'
                                         + '  <p style="color: #BCBEBD; font-size:10px; margin-top:-15px;">Just now</p>'
                                         + ' <p style="width:98%; text-align:left; margin-top:-10px; color:#000">'+ user_reply +'</p>'
                                         + '  </div>'
                                         + '  </div>');
                }
                document.getElementById("repText").value="";
                
            }
            
            function continueMsg(id){
                url2 = 'http://famly.com/beta/public/ws/postMessages.php';
                var un=sessionStorage.getItem('username');
                var hash=sessionStorage.getItem('password');
                var userId=sessionStorage.getItem('userid');
                sessionStorage['friendId'] =id;
                //alert("continueMessage"+sessionStorage['friendId'])
                $("div#stream").show();
                $("div#panel3").slideUp(400);
                var currentDate = new Date();
                var now = currentDate.toUTCString();
                //alert(now);
                var date = now.split(",");
                var Cdatefinal=date[0]+" "+date[1];
                var Cdatefinal1=date[1];
                var Cdatefinal2=Cdatefinal1.split(" ");
                var dddd=date[0]+" "+Cdatefinal2[2]+" "+Cdatefinal2[1]+" "+Cdatefinal2[3]+" "+Cdatefinal2[4]+" "+Cdatefinal2[5];
                var time=Cdatefinal2[4].split(":");
                var posthour = time[0];
                var postminute = time[1];
                var postsecond = time[2];
                var month=parseMonth(Cdatefinal2[2]);
                month=month-1;
                var day=Cdatefinal2[1];
                var ddddd=new Date(Cdatefinal2[3],month,day,posthour,postminute,postsecond,00);
                //$("#panel3").attr("class","p3");
                $("#msgList").empty();
                $("#newMsgButton").attr("style","padding-top:5%; margin-bottom:-5px; padding-left:80%; height:15%; display:none");
                $("#reply_post").attr("style","display:inline");
                $("#msgList").removeClass("nmsg");
                $("#msgList").addClass("rmsg");
                // setInterval(function(){
                $.get(url2,{username: un, password: hash,friendId:id}, function(data){
                      data3 = $.parseJSON(data);
                      $(data3).each(function(i,val){
                                    var postDate=val.created_at;
                                    var date = postDate.split("-");
                                    var postyyyy = date[0];
                                    var postmm = date[1]-1;
                                    var day_time = date[2];
                                    var day = day_time.split(" ");
                                    var postdd= day[0];
                                    var postTime=day[1];
                                    var time=postTime.split(":");
                                    var posthour = time[0];
                                    var postminute = time[1];
                                    var postsecond = time[2];
                                    var postDateTime=new Date(postyyyy,postmm,postdd,posthour,postminute,postsecond,00);
                                    var timeTrack=timeDifference(ddddd,postDateTime);
                                    if(!$("#chat"+val.id).is(":visible")){
                                    $("#msgList").append('<div id="chat'+val.id+'" style="background: #FFF; border:1px solid">'
                                                         + ' <div style="height:40px !important; width:40px !important; border:2px solid #DEDEDE; box-shadow:none; margin:1% 1% 1% 1%"> '
                                                         + '  <img src="http://famly.com/beta/public/uploads/user_pics/'+ val.picture +'" style="width:100%; height:100%; overflow:hidden  " alt="loading" > '
                                                         + '  </div> '
                                                         + ' <div id="realPic'+val.id+'" style=" height:15%; width:15%; margin-left:85.5%; margin-top:-50px"><img src="img/level.png"/></div>'
                                                         + ' <div id="realNum'+val.id+'" style="margin-top:-40px; margin-left:93%; color:#FFF; font-weight:600">+'+val.relation_level+'</div>'
                                                         + '  <div  align="left" style="margin-left:20%; margin-top:-20px">'
                                                         + '  <p style="color:#12B6E9; font-weight:600;">'+ val.full_name +'</p>'
                                                         + '  <p id="timeChat'+val.id+'" style="color: #BCBEBD; font-size:10px; margin-top:-15px;">'+timeTrack+', Chicago</p>'
                                                         + ' <p style="width:98%; text-align:left; margin-top:-10px; color:#000">'+ val.message +'</p>'
                                                         + '  </div>'
                                                         + '  </div>');
                                    if(val.relation_level==0 || val.sender_id == userId){
                                    // $("#realNum"+val.id).hide();
                                    $("#realPic"+val.id).hide();
                                    }}else{
                                    $("#timeChat"+val.id).html(timeTrack);
                                    }
                                    
                                    })
                      
                      });
                
                $("div#panel3").slideDown(400);
                // }, 500);
            }
            
            function newMessage(){
                $("div#panel3").slideUp(400);
                $("div#panel7").slideDown(400);
                //alert("newMessage");
            }
            
            function sendMsg(){
                var sender=document.getElementById('msgRecp').value;
                var names=sender.split(",");
                
                var message=document.getElementById('msgText').value;
                var indexArray= new Array();
                var k=0;
                
                // var members;
                for(i=0;i<fname.length;i++){
                    for(j=0;j<names.length;j++){
                        if(names[j]==fname[i]){
                            // alert(i);
                            indexArray[k]=i;
                            k=k+1;
                        }
                    }
                }
                
                var index;
                var members=new Array();
                for(m=0;m<indexArray.length;m++){
                    index=indexArray[m];
                    members[m]=fid[index];
                    
                }
                
                var memberstoSend=members.toString();
                if(message!=""){
                    var un=sessionStorage.getItem('username');
                    var hash=sessionStorage.getItem('password');
                    //alert(fname[index]);
                    url2 ='http://famly.com/beta/public/ws/sendMultipleMessage.php';
                    $.get(url2,{members:memberstoSend,username:un,password:hash,message:message}, function(data){
                          if(data==1){
                          document.getElementById('msgRecp').value="";
                          document.getElementById('msgText').value="";
                          $("div[id^=panel]").slideUp(400);
                          }
                          });
                }
                
                
            }
            
            function showMsgs(){
                url2 = 'http://famly.com/beta/public/ws/messages.php';
                var un=sessionStorage.getItem('username');
                var hash=sessionStorage.getItem('password');
                $("#msgList").empty();
                $("#reply_post").attr("style","display:none");
                $("#msgList").removeClass("rmsg");
                $("#msgList").addClass("nmsg");
                $("#newMsgButton").attr("style","position:absolute; margin-top:3%; margin-left:90%; display:inline");
                //$("#panel3").attr("class","panel3");
                var currentDate = new Date();
                var now = currentDate.toUTCString();
                //alert(now);
                var date = now.split(",");
                var Cdatefinal=date[0]+" "+date[1];
                var Cdatefinal1=date[1];
                var Cdatefinal2=Cdatefinal1.split(" ");
                var dddd=date[0]+" "+Cdatefinal2[2]+" "+Cdatefinal2[1]+" "+Cdatefinal2[3]+" "+Cdatefinal2[4]+" "+Cdatefinal2[5];
                var time=Cdatefinal2[4].split(":");
                var posthour = time[0];
                var postminute = time[1];
                var postsecond = time[2];
                var month=parseMonth(Cdatefinal2[2]);
                month=month-1;
                var day=Cdatefinal2[1];
                var ddddd=new Date(Cdatefinal2[3],month,day,posthour,postminute,postsecond,00);
                $.get(url2,{username: un, password: hash}, function(data){
                      //alert(data);
                      data2 = $.parseJSON(data);
                      $(data2).each(function(i,val){
                                    var postDate=val.created_at;
                                    var date = postDate.split("-");
                                    var postyyyy = date[0];
                                    var postmm = date[1]-1;
                                    var day_time = date[2];
                                    var day = day_time.split(" ");
                                    var postdd= day[0];
                                    var postTime=day[1];
                                    var time=postTime.split(":");
                                    var posthour = time[0];
                                    var postminute = time[1];
                                    var postsecond = time[2];
                                    var postDateTime=new Date(postyyyy,postmm,postdd,posthour,postminute,postsecond,00);
                                    var timeTrack=timeDifference(ddddd,postDateTime);
                                    $("#msgList").append('<div class="swipe" style="background: #FFF; border:1px solid" id="msg'+i+'" onClick="continueMsg('+ val.sender_id +')">'
                                                         + ' <div style="height:40px !important; width:40px !important; border:2px solid #DEDEDE; box-shadow:none; margin:1% 1% 1% 1%"> '
                                                         + '  <img src="http://famly.com/beta/public/uploads/user_pics/'+ val.picture +'" style="width:100%; height:100%; overflow:hidden  " alt="loading" > '
                                                         + '  </div> '
                                                         + ' <div id="realPic'+val.id+'" style="height:15%; width:15%; margin-left:85.5%; margin-top:-50px"><img src="img/level.png"/></div>'
                                                         + ' <div id="realNum'+val.id+'" style="margin-top:-40px; margin-left:93%; color:#FFF; font-weight:600">+'+val.relation_level+'</div>'
                                                         + '  <div align="left" style="margin-left:20%; margin-top:-20px">'
                                                         + '  <p style="color:#12B6E9; font-weight:600;">'+ val.full_name +'</p>'
                                                         + '  <p style="color: #BCBEBD; font-size:10px; margin-top:-15px;">'+timeTrack+'</p>'
                                                         + ' <p style="width:98%; text-align:left; margin-top:-10px; color:#000">'+ val.message + '</p>'
                                                         + '  </div>'
                                                         + '  </div>');
                                    if(val.relation_level==0){
                                    // $("#realNum"+val.id).hide();
                                    $("#realPic"+val.id).hide();
                                    }
                                    
                                    
                                    });
                      
                      /*     $("#panel3").append('<div style="padding-top:5%; margin-bottom:-5px; padding-left:80%; position:absolute">'
                       +'  <button class="btn" type="button" style="width:30px; height:30px; background:#F88E1E;" onClick="newMessage()"><div style="margin-left:-13px; height:30px; width:30px"><img src="img/newMsg.png"/ style="margin-top:-4px"></div></button>'
                       + ' </div>'
                       + '  &nbsp;'); */
                      });
                
            }
            
            function attachURL(txt, lnk){
                var id = sessionStorage.getItem('link');
                var anchor = '<a id="sharedLink'+id+'" name="'+ lnk +'" onClick="showLink('+id+')">'+ txt.match(/\>(.*?)\</)[1] +'</a>'
                txt = txt.replace(/\>(.*?)\</, anchor);
                return txt;
            }
            
            $(function ($) {
              $("#updtView").click(function () {
                                   //$("#updt").unbind("click");
                                   $("#postview").slideToggle();
                                   });
              
              $("#updt").click(function () {
                               var stat=document.getElementById('statText').value;
                               if (stat == "") { stat = " ";}
                               var status = stat;
                               if($("#attachStatLink").is(":visible") && $("#statLink").val() != ""){
                               
                               if (!sessionStorage['link']) {
                               sessionStorage['link'] = 0;
                               } else {
                               sessionStorage['link']++;
                               }
                               status = attachURL(stat, $("#statLink").val());
                               
                               }
                               if($("#statImageDiv").is(":visible")){
                               uploadImg(sessionStorage.getItem('imgAtch'), status);
                               return;
                               }
                               else if($("#statVidDiv").is(":visible")){
                               uploadVid(sessionStorage.getItem('vidAtch'), status);
                               return;
                               }
                               console.log(status);
                               var lower_range=parseInt($('#panel4 #lower').html());
                               var higher_range=parseInt($('#panel4 #higher').html());
                               var range=lower_range+','+higher_range;
                               //alert(range);
                               url3 = 'http://famly.com/beta/public/ws/updateStatus.php';
                               var un=sessionStorage.getItem('username');
                               var hash=sessionStorage.getItem('password');
                               var crloc = sessionStorage.getItem('currLoc');
                               console.log(un+hash+crloc);
                               if(document.getElementById('statText').value!=""){
                               $.get(url3,{username:un,password:hash,type:"Text",statusUpdate:encodeURIComponent(status),location:crloc,range:range}, function(data){
                                     document.getElementById('statText').value="";
                                     $("div[id^=panel]").slideUp(400);
                                     });
                               
                               }
                               });
              });
            
            </script>

    </body>
</html>


